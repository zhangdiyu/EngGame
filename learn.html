<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Learn Words - å•è¯å­¦ä¹ </title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    /* æœç´¢æ¡† */
    .search-box {
      background: white;
      border-radius: 50px;
      padding: 12px 20px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .search-box i {
      color: #999;
      font-size: 18px;
    }

    .search-box input {
      border: none;
      outline: none;
      font-size: 16px;
      flex: 1;
      background: transparent;
    }

    /* åˆ†ç±»åŒºåŸŸ */
    .category-section {
      margin-bottom: 20px;
    }

    .category-header {
      color: white;
      font-size: 18px;
      margin-bottom: 12px;
      padding: 10px 15px;
      background: rgba(255,255,255,0.15);
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .category-header:hover {
      background: rgba(255,255,255,0.25);
    }

    .category-header .header-emoji {
      font-size: 24px;
    }

    .category-header .header-count {
      margin-left: auto;
      font-size: 13px;
      opacity: 0.8;
      background: rgba(255,255,255,0.2);
      padding: 3px 10px;
      border-radius: 15px;
    }

    .category-header .toggle-icon {
      font-size: 14px;
      transition: transform 0.3s;
    }

    .category-header.collapsed .toggle-icon {
      transform: rotate(-90deg);
    }

    .category-content {
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .category-content.collapsed {
      max-height: 0 !important;
    }

    /* å¡ç‰‡ç½‘æ ¼ */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      padding: 5px;
    }

    /* é€šç”¨å¡ç‰‡ */
    .word-card {
      background: white;
      border-radius: 15px;
      padding: 12px 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      min-height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .word-card:active {
      transform: scale(0.95);
    }

    .word-card.playing {
      animation: cardPulse 0.5s ease-out;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.5);
    }

    .card-icon {
      font-size: 40px;
      margin-bottom: 6px;
      line-height: 1;
    }

    .card-name {
      font-size: 12px;
      font-weight: bold;
      color: #333;
      margin-bottom: 2px;
      word-break: break-word;
      line-height: 1.2;
    }

    .card-chinese {
      font-size: 11px;
      color: #666;
    }

    .card-letter {
      font-size: 20px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 2px;
    }

    /* é¢œè‰²å¡ç‰‡ */
    .word-card.color-card {
      border: 2px solid transparent;
    }

    @keyframes cardPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    /* ç»Ÿè®¡æ  */
    .stats-bar {
      background: rgba(255,255,255,0.2);
      border-radius: 15px;
      padding: 10px 15px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-around;
      color: white;
      font-weight: bold;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      font-size: 22px;
      display: block;
    }

    .stat-label {
      font-size: 11px;
      opacity: 0.9;
    }

    /* æ²¡æœ‰ç»“æœ */
    .no-results {
      text-align: center;
      padding: 50px;
      color: rgba(255,255,255,0.8);
    }

    .no-results i {
      font-size: 50px;
      margin-bottom: 15px;
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-icon">ğŸ“š</div>
      <h1 class="page-title">Learn Words</h1>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="stats-bar">
      <div class="stat-item">
        <span class="stat-number" id="totalCount">0</span>
        <span class="stat-label">Words å•è¯</span>
      </div>
      <div class="stat-item">
        <span class="stat-number" id="categoryCount">0</span>
        <span class="stat-label">Categories åˆ†ç±»</span>
      </div>
    </div>

    <!-- æœç´¢æ¡† -->
    <div class="search-box">
      <i class="fa-solid fa-search"></i>
      <input type="text" id="searchInput" placeholder="Search words... æœç´¢å•è¯">
    </div>

    <!-- æ‰€æœ‰åˆ†ç±»å†…å®¹ -->
    <div id="contentArea">
      <!-- é€šè¿‡JSç”Ÿæˆ -->
    </div>
  </div>

  <a href="index.html" class="back-btn">
    <i class="fa-solid fa-house"></i>
    Home
  </a>

  <script src="js/speech.js"></script>
  <script src="js/words-data.js"></script>
  <script src="js/vehicles-data.js"></script>
  <script>
    let searchQuery = '';

    // åˆ¤æ–­é¢œè‰²æ·±æµ…
    function isLightColor(hex) {
      if (!hex) return true;
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      const brightness = (r * 299 + g * 587 + b * 114) / 1000;
      return brightness > 150;
    }

    // åˆå§‹åŒ–
    function init() {
      updateStats();
      render();
      bindEvents();
    }

    // æ›´æ–°ç»Ÿè®¡
    function updateStats() {
      // è®¡ç®—æ€»æ•°ï¼šWordsDataï¼ˆä¸å«vehiclesï¼‰+ VehiclesData
      const wordsCount = WordsData.getTotalCount() - (WordsData.vehicles?.length || 0);
      const vehiclesCount = VehiclesData.getAllVehicles().length;
      document.getElementById('totalCount').textContent = wordsCount + vehiclesCount;
      document.getElementById('categoryCount').textContent = WordsData.getCategories().length;
    }

    // æ¸²æŸ“å¡ç‰‡å†…å®¹
    function renderCard(item, catKey) {
      // å­—æ¯åˆ†ç±»ç‰¹æ®Šå¤„ç†
      if (catKey === 'letters' && item.letter) {
        return `
          <div class="card-letter">${item.letter}</div>
          <div class="card-icon">${item.emoji}</div>
          <div class="card-name">${item.name}</div>
          <div class="card-chinese">${item.chinese}</div>
        `;
      }
      // é¢œè‰²åˆ†ç±»
      if (catKey === 'colors' && item.hex) {
        const textColor = isLightColor(item.hex) ? '#333' : '#fff';
        return `
          <div class="card-icon">${item.emoji}</div>
          <div class="card-name" style="color: ${textColor}">${item.name}</div>
          <div class="card-chinese" style="color: ${textColor}; opacity: 0.8">${item.chinese}</div>
        `;
      }
      // äº¤é€šå·¥å…·åˆ†ç±» - åªæ˜¾ç¤ºå›¾ç‰‡ï¼Œä¸æ˜¾ç¤ºemoji
      if (catKey === 'vehicles') {
        if (item.image) {
          // æœ‰å›¾ç‰‡åªæ˜¾ç¤ºå›¾ç‰‡ï¼Œå¤±è´¥æ—¶æ˜¾ç¤ºç°è‰²å›¾æ ‡
          return `
            <div class="card-icon"><img src="images/vehicles/${item.image}" alt="${item.name}" style="width:50px;height:50px;object-fit:contain;" onerror="this.style.display='none'"></div>
            <div class="card-name">${item.name}</div>
            <div class="card-chinese">${item.chinese || ''}</div>
          `;
        }
        // æ— å›¾ç‰‡çš„è½¦è¾†ä¸æ˜¾ç¤º
        return `
          <div class="card-icon"><i class="fa-solid fa-car" style="font-size:30px;color:#ccc;"></i></div>
          <div class="card-name">${item.name}</div>
          <div class="card-chinese">${item.chinese || ''}</div>
        `;
      }
      // é»˜è®¤
      return `
        <div class="card-icon">${item.emoji || ''}</div>
        <div class="card-name">${item.name}</div>
        <div class="card-chinese">${item.chinese || ''}</div>
      `;
    }

    // æ¸²æŸ“æ‰€æœ‰åˆ†ç±»
    function render() {
      const container = document.getElementById('contentArea');
      const categories = WordsData.getCategories();
      let html = '';
      let hasResults = false;

      categories.forEach(cat => {
        // vehicles åˆ†ç±»ä½¿ç”¨å®Œæ•´çš„ VehiclesDataï¼ˆåŒ…å«å›¾ç‰‡ï¼‰
        let items = cat.key === 'vehicles'
          ? VehiclesData.getAllVehicles()
          : (WordsData[cat.key] || []);

        // æœç´¢è¿‡æ»¤
        if (searchQuery) {
          const query = searchQuery.toLowerCase();
          items = items.filter(item => {
            return (item.name && item.name.toLowerCase().includes(query)) ||
                   (item.chinese && item.chinese.includes(query)) ||
                   (item.letter && item.letter.toLowerCase().includes(query));
          });
        }

        if (items.length === 0) return;
        hasResults = true;

        html += `
          <div class="category-section">
            <div class="category-header" onclick="toggleCategory('${cat.key}')">
              <span class="header-emoji">${cat.emoji}</span>
              <span>${cat.name} ${cat.chinese}</span>
              <span class="header-count">${items.length}</span>
              <i class="fa-solid fa-chevron-down toggle-icon"></i>
            </div>
            <div class="category-content" id="content-${cat.key}">
              <div class="card-grid">
        `;

        items.forEach(item => {
          const extraClass = cat.key === 'colors' ? 'color-card' : '';
          const style = (cat.key === 'colors' && item.hex)
            ? `background-color: ${item.hex}; border-color: ${item.hex};`
            : '';

          html += `
            <div class="word-card ${extraClass}" style="${style}"
                 onclick="playWord('${item.name}', '${item.chinese || ''}', this)">
              ${renderCard(item, cat.key)}
            </div>
          `;
        });

        html += '</div></div></div>';
      });

      if (!hasResults) {
        html = `
          <div class="no-results">
            <i class="fa-solid fa-search"></i>
            <div>No results found</div>
            <div>æ²¡æœ‰æ‰¾åˆ°ç»“æœ</div>
          </div>
        `;
      }

      container.innerHTML = html;
    }

    // åˆ‡æ¢åˆ†ç±»å±•å¼€/æŠ˜å 
    function toggleCategory(key) {
      const header = event.currentTarget;
      const content = document.getElementById(`content-${key}`);

      header.classList.toggle('collapsed');
      content.classList.toggle('collapsed');
    }

    // æ’­æ”¾å‘éŸ³
    async function playWord(name, chinese, element) {
      element.classList.add('playing');
      await SpeechModule.speakBilingual(name, chinese);
      element.classList.remove('playing');
    }

    // ç»‘å®šäº‹ä»¶
    function bindEvents() {
      document.getElementById('searchInput').addEventListener('input', (e) => {
        searchQuery = e.target.value;
        render();
      });
    }

    // å¯åŠ¨
    init();
  </script>
</body>
</html>
